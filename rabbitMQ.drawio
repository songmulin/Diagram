<mxfile host="app.diagrams.net" modified="2021-01-12T06:45:04.623Z" agent="5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36" etag="uY3yenTQuHNtWUPuKRfW" version="14.1.9" type="github">
  <diagram id="YkF_xr2YK-9CTUuaJ1Um" name="Page-1">
    <mxGraphModel dx="782" dy="469" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="eu5U1hnf9LweZi0uD29D-2" value="rabbitmq集群模式&lt;br&gt;单机模式&lt;br&gt;普通模式：某一个rabbitmq宕机，实例上的queue就不可用&lt;br&gt;镜像模式，元数据和queue的消息存在多个实例上，写入消息时，多个实例里面queue消息需要进行同步" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="1270" width="50" height="100" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.015;entryY=0.206;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-5" target="eu5U1hnf9LweZi0uD29D-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-5" value="Producer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="20" y="415" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-33" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.015;entryY=0.771;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-6" target="eu5U1hnf9LweZi0uD29D-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-6" value="Producer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="20" y="500" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=-0.012;entryY=0.439;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-9" target="eu5U1hnf9LweZi0uD29D-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="485" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-9" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="180" y="410" width="90" height="150" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-11" value="channel" style="strokeWidth=1;outlineConnect=0;dashed=0;align=center;html=1;fontSize=8;shape=mxgraph.eip.messageChannel;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="190" y="450" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-13" value="channel" style="strokeWidth=1;outlineConnect=0;dashed=0;align=center;html=1;fontSize=8;shape=mxgraph.eip.messageChannel;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="190" y="510" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-40" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1.014;exitY=0.438;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-14" target="eu5U1hnf9LweZi0uD29D-26" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-14" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="380" width="210" height="240" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-16" value="Broker&lt;br&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="410" y="380" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-17" value="Exchange" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="435" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-18" value="Exchange" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="344" y="540" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-19" value="Queue" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="405" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-20" value="Queue" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="460" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-21" value="Queue" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="510" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-22" value="Queue" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="450" y="570" width="70" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-23" value="connection" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="200" y="410" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-41" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.167;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-26" target="eu5U1hnf9LweZi0uD29D-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1.022;exitY=0.836;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-26" target="eu5U1hnf9LweZi0uD29D-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-26" value="" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="610" y="410" width="90" height="150" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-27" value="channel" style="strokeWidth=1;outlineConnect=0;dashed=0;align=center;html=1;fontSize=8;shape=mxgraph.eip.messageChannel;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="620" y="450" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-28" value="channel" style="strokeWidth=1;outlineConnect=0;dashed=0;align=center;html=1;fontSize=8;shape=mxgraph.eip.messageChannel;verticalLabelPosition=bottom;labelBackgroundColor=#ffffff;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="620" y="510" width="70" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-29" value="connection" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="630" y="410" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-30" value="Consumer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="750" y="410" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-31" value="Consumer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="750" y="510" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-36" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-17" target="eu5U1hnf9LweZi0uD29D-19" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="470" as="sourcePoint" />
            <mxPoint x="470" y="420" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-37" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="eu5U1hnf9LweZi0uD29D-17" target="eu5U1hnf9LweZi0uD29D-20" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="460" as="sourcePoint" />
            <mxPoint x="460" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-38" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" target="eu5U1hnf9LweZi0uD29D-21" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="414" y="550" as="sourcePoint" />
            <mxPoint x="447" y="522" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-39" value="" style="endArrow=classic;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" target="eu5U1hnf9LweZi0uD29D-22" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="414" y="550" as="sourcePoint" />
            <mxPoint x="454" y="575" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-43" value="&lt;ul style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px 0px 24px ; padding: 0px ; list-style: none ; font-size: 16px ; overflow-wrap: break-word ; color: rgb(51 , 51 , 51) ; font-family: , &amp;#34;sf ui text&amp;#34; , &amp;#34;arial&amp;#34; , &amp;#34;pingfang sc&amp;#34; , &amp;#34;hiragino sans gb&amp;#34; , &amp;#34;microsoft yahei&amp;#34; , &amp;#34;wenquanyi micro hei&amp;#34; , sans-serif , &amp;#34;simhei&amp;#34; , &amp;#34;simsun&amp;#34; ; background-color: rgb(255 , 255 , 255)&quot;&gt;&lt;li style=&quot;box-sizing: border-box ; outline: 0px ; margin: 8px 0px 0px 32px ; padding: 0px ; list-style: disc ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Broker&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;：消息队列服务进程，此进程包括两个部分：&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Exchange&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;和&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Queue&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; outline: 0px ; margin: 8px 0px 0px 32px ; padding: 0px ; list-style: disc ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Exchange&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;：消息队列交换机，按一定的规则将消息路由转发到某个队列，对消息进行过虑。&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; outline: 0px ; margin: 8px 0px 0px 32px ; padding: 0px ; list-style: disc ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Queue&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;：消息队列，存储消息的队列，消息到达队列并转发给指定的&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; outline: 0px ; margin: 8px 0px 0px 32px ; padding: 0px ; list-style: disc ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Producer&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;：消息生产者，即生产方客户端，生产方客户端将消息发送&lt;/span&gt;&lt;/li&gt;&lt;li style=&quot;box-sizing: border-box ; outline: 0px ; margin: 8px 0px 0px 32px ; padding: 0px ; list-style: disc ; overflow-wrap: break-word&quot;&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;Consumer&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;：消息消费者，即消费方客户端，接收&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;MQ&lt;/span&gt;&lt;span style=&quot;box-sizing: border-box ; outline: 0px ; margin: 0px ; padding: 0px ; overflow-wrap: break-word&quot;&gt;转发的消息。&lt;/span&gt;&lt;/li&gt;&lt;/ul&gt;" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="40" y="640" width="60" height="150" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-44" value="producer 到 exchange防止消息丢失：&lt;br&gt;1.事物模式，开启事物，异常时进行事物回滚，性能低下&lt;br&gt;2.confirm模式，发送消息之前，channel.confirmSelect //开启发送方确认模式，channel.waitForConfirm // 等待所有消息都已发布，只有有一个未别确认，IOException" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="49" y="850" width="50" height="100" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-45" value="Exchange:&lt;br&gt;1.接收生产者发送的消息&lt;br&gt;2.如何处理消息？递交给某个队列，所有队列，还是丢弃，取决exchange类型&lt;br&gt;类型：&lt;br&gt;fanout:广播，将消息交给所有绑定到交换机的队列&lt;br&gt;direct:定向，把消息交给符合指定routing key的队列(精确匹配)&lt;br&gt;topic:通配符，把消息交给符合routing pattern（路由模式）的队列（模糊匹配）&lt;br&gt;header:" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="49" y="970" width="51" height="130" as="geometry" />
        </mxCell>
        <mxCell id="eu5U1hnf9LweZi0uD29D-46" value="消息丢失场景&lt;br&gt;1.生产者发送到exchange: 采用事物或者confirm模式, 事物采用的是同步模式，会产生阻塞，confirm是异步模式，采用回调的方式，吞吐率高&lt;br&gt;2.消费方消费到消息丢失：采用手动ACK机制&lt;br&gt;3.发送到MQ时宕机了：可以将消息进行持久化（写入磁盘），前提 exchange queue也需要持久化" style="strokeWidth=2;html=1;shape=mxgraph.flowchart.annotation_1;align=left;pointerEvents=1;" parent="1" vertex="1">
          <mxGeometry x="50" y="1140" width="45" height="100" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
